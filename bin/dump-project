#!/usr/bin/env ruby

if ARGV.size != 1
  $stderr.puts("Usage: #{$0} identifier")
  $stderr.puts(" e.g.: #{$0} my-project")
  exit(false)
end

config_dir = File.expand_path("../../../../config",  __FILE__)
APP_PATH = File.join(config_dir, "application")
require APP_PATH
Rails.application.require_environment!

def dump_components(output_dir, component, json)
end

identifier = ARGV[0]
project = Project.find_by_identifier!(identifier)
arguments = {
  "filter" => "project_id == #{project.id}",
  "limit" => "-1",
}
command = Groonga::Command::Select.new("select", arguments)
response = FullTextSearch::Target.select(command)
File.open("#{identifier}.json", "w") do |output|
  output.puts(JSON.pretty_generate(response.records))
end
